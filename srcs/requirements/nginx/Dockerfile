FROM debian:bullseye

RUN apt-get update && apt-get install -y \
    nginx \
    openssl \
    && rm -rf /var/lib/apt/lists/*

RUN mkdir -p /etc/nginx/ssl

RUN openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout /etc/nginx/ssl/nginx.key \
    -out /etc/nginx/ssl/nginx.crt \
    -subj "/C=ES/ST=Malaga/L=Malaga/O=42/CN=chanin.42.fr"

COPY conf/nginx.conf /etc/nginx/nginx.conf

EXPOSE 443

CMD ["nginx", "-g", "daemon off;"]


# ##########################
# Resumen mental
# Este Dockerfile:
# Crea un Debian
# Instala Nginx y OpenSSL
# Genera certificados SSL
# Copia tu configuraciÃ³n
# Arranca Nginx en HTTPS
# ##########################
# Quiero un ordenador vacÃ­o con Debian instalado
# â†’ Actualiza la lista de programas disponibles.
# â†’ Instala:
# nginx â†’ el servidor web
# openssl â†’ herramienta para crear certificados SSL
# â†’ Limpia archivos temporales para que la imagen pese menos.
# ðŸ“Œ Resultado: el contenedor ya tiene Nginx + OpenSSL instalados.
# 
# Crea la carpeta donde guardaremos los certificados SSL.
# -p asegura que no falle si alguna carpeta ya existe.
# ðŸ“Œ Resultado: existe /etc/nginx/ssl.
# 
# AquÃ­ se crea un certificado SSL autofirmado:
# openssl req â†’ crear un certificado
# -x509 â†’ certificado autofirmado (no de una autoridad oficial)
# -nodes â†’ sin contraseÃ±a (necesario para Docker)
# -days 365 â†’ vÃ¡lido durante 1 aÃ±o
# -newkey rsa:2048 â†’ clave RSA de 2048 bits
# Archivos que se generan:
# /etc/nginx/ssl/nginx.key â†’ clave privada
# /etc/nginx/ssl/nginx.crt â†’ certificado pÃºblico
# CN=chanin.42.fr
# â†’ El dominio del certificado (muy importante para Inception).
# ðŸ“Œ Resultado: Nginx puede usar HTTPS.
# 
# Copia tu archivo de configuraciÃ³n de Nginx desde el proyecto
# Lo pone donde Nginx lo espera dentro del contenedor
# ðŸ“Œ Resultado: Nginx usarÃ¡ tu configuraciÃ³n personalizada,
# no la por defecto.
# 
# Indica que el contenedor usarÃ¡ el puerto 443 (HTTPS).
# No abre el puerto por sÃ­ solo, solo lo documenta para Docker.
# ðŸ“Œ El puerto real se abre en docker-compose.yml.
# 
# Arranca Nginx cuando el contenedor se ejecuta.
# daemon off; obliga a Nginx a quedarse en primer plano.
# ðŸ“Œ Esto es obligatorio en Docker:
# si el proceso principal termina â†’ el contenedor se apaga.
# ##########################
